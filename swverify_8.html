<HTML>
<HEAD>
<TITLE>swverify(8)</TITLE>
<STYLE>
<!--
i {color:#000080}
-->
</STYLE>
</HEAD>
<BODY BGCOLOR="#ffffff">
<H1>swverify(8)</H1>
<h3>Contents</h3><ul>
<li><a href="#NAME">NAME</a>
<li><a href="#SYNOPSIS">SYNOPSIS</a>
<li><a href="#DESCRIPTION">DESCRIPTION</a>
<li><a href="#OPTIONS">OPTIONS</a>
<li><a href="#POSIX EXTENDED OPTIONS">POSIX EXTENDED OPTIONS</a>
<li><a href="#IMPLEMENTATION EXTENSION OPTIONS">IMPLEMENTATION EXTENSION OPTIONS</a>
<li><a href="#VENDOR SCRIPTS">VENDOR SCRIPTS</a>
<li><a href="#IMPLEMENTATION EXTENSION VENDOR SCRIPTS">IMPLEMENTATION EXTENSION VENDOR SCRIPTS</a>
<ul><li><a href="#Execution Environment"><font size=-1>Execution Environment</font></a>
</ul><li><a href="#VERIFYING SIGNATURES">VERIFYING SIGNATURES</a>
<ul><li><a href="#Verifying a POSIX distribution Manually"><font size=-1>Verifying a POSIX distribution Manually</font></a>
<li><a href="#Verifying a POSIX distribution in tar format"><font size=-1>Verifying a POSIX distribution in tar format</font></a>
<li><a href="#Verifying the directory (unpacked) form of a Distribution."><font size=-1>Verifying the directory (unpacked) form of a Distribution.</font></a>
<li><a href="#Verifying Installed Software"><font size=-1>Verifying Installed Software</font></a>
</ul><li><a href="#EXAMPLES">EXAMPLES</a>
<ul><li><a href="#Distribution Verification"><font size=-1>Distribution Verification</font></a>
<li><a href="#Installed Software Verification"><font size=-1>Installed Software Verification</font></a>
</ul><li><a href="#RETURN VALUE">RETURN VALUE</a>
<li><a href="#FILES">FILES</a>
<li><a href="#APPLICABLE STANDARDS">APPLICABLE STANDARDS</a>
<li><a href="#SEE ALSO">SEE ALSO</a>
<li><a href="#IDENTIFICATION">IDENTIFICATION</a>
<li><a href="#BUGS">BUGS</a>
</ul><pre>
</pre><h3><a name="NAME"><b>NAME</b></a></h3><pre>       swverify -- Verify Software
</pre><h3><a name="SYNOPSIS"><b>SYNOPSIS</b></a></h3><pre>       Posix:

       <b>swverify</b>  [-d|-r]  [-F]  [-f <i>file</i>]  [-t <i>targetfile</i>] \
       [-x <i>option=value</i>]  [-X <i>options</i><b>_</b><i>file</i>]  [-W <i>option</i>] \
       [software_selections]  [@targets]

       <b>swverify</b>

       <b>swverify</b> -r selection [@ target]

       <b>swverify</b> -d [@ target]

       <b>swverify</b> -d @-   # Note: special meaning for dash as stdin

       <b>swverify</b> -d @.   # Note: special meaning for . as current directory

       Implementation Extension:

       <b>swverify</b> --checksig [portable_archive_file]

       <b>swverify</b> --checksig <i>directory</i>

       <b>swverify</b> [-Wd] -Wemit-signed-file [portable_archive_file]

       <b>swverify</b> [-Wd] [-Wsha1] -Wemit-digest-file [portable_archive_file]

       <b>swverify</b> [-Wd] -Wget-sig-if=sigfilename [portable_archive_file]

</pre><h3><a name="DESCRIPTION"><b>DESCRIPTION</b></a></h3><pre>       The  <b>swverify</b>  utility checks the accuracy of software in distributions
       and installed_software.  If no options are given, a serial distribution
       on stdin is verified.

       Currently,  <b>swverify</b>  does  not  read  the  defaults files.  &quot;/&quot; is the
       default target for installed software.  Stdin is the default target for
       distributions.   The  built-in value of &quot;installed_software_catalog&quot; is
       &quot;var/lib/swbis/catalog&quot;.

</pre><h3><a name="OPTIONS"><b>OPTIONS</b></a></h3><pre>       <b>-d</b>

              Specify to operate on a distribution rather than installed soft-
              ware.

       <b>-r</b>

              Specify to operate on installed software at the target path.



       <b>software_selections</b>

              See other man pages.


       <b>targets</b>

              See  other  man  pages.   Currently,  only <a href=one _1.html>one (1)</a> target can be
              specified.


       <b>-x option=value</b>

              Specify the extended option overriding the defaults file  value.
              This option not yet implemented.

       <b>-X FILE</b>

              Specify  the  extended  options  filename, FILE,  overriding the
              default filename.  This option not yet implemented.

       Other posix options not implemented.

</pre><h3><a name="POSIX EXTENDED OPTIONS"><b>POSIX EXTENDED OPTIONS</b></a></h3><pre>       Not yet implemented.

</pre><h3><a name="IMPLEMENTATION EXTENSION OPTIONS"><b>IMPLEMENTATION EXTENSION OPTIONS</b></a></h3><pre>       <b>-W option[,option,...]</b>

              Specify the implementation extension option.
              Syntax: -W option[=option_argument[,option...]
              Options may be separated by a comma.

       <b>--checksig | -W checksig</b>

              If target file is not a directory then verify  archive  md5  and
              sha1  and  gpg signature directly from the file.  If target file
              is a directory, attempt to verify the signature  using  GNU  tar
              and  gpg  and  if successful execute the vendor extension script
              <b>checksig</b>.  If <b>checksig</b> does not exist then exit with failure.
              FILE may be &quot;.&quot; (current directory) or &quot;-&quot; (standard input).   A
              serial  archive file may be compressed with gzip, bzip2, or Unix
              compress.


       <b>-W emit-signed-file | -W C</b>

              Read archive file FILE or standard input and  write  the  signed
              file  (i.e.  gpg's signed stuff) to stdout.  This is the catalog
              section of the Posix package.


       <b>-W emit-digest-file | -W S</b>

              Read archive file FILE or standard input and write  the  archive
              section of the file (that was used to make the md5 and sha1 mes-
              sage digests) to stdout.  This is the  storage  section  of  the
              Posix package.


       <b>-W show-auth-files | -W d</b>

              Writes  the  relevent security file to stderr.  Applies to emit-
              digest-file and emit-signed-file modes.


       <b>-W sig-number=N</b>

              Operates on the Nth signature, 0 is last, 1 is the first.


       <b>-W get-sig-if=outputfile</b>

              Verifies the archive digests by comparing to the digests in  the
              catalog  and  if  they match write the sigfile to outputfile and
              the signed data to stdout.

</pre><h3><a name="VENDOR SCRIPTS"><b>VENDOR SCRIPTS</b></a></h3><pre>       swverify can execute a vendor supplied <b>fix</b>  script.

       Not yet implemented.

</pre><h3><a name="IMPLEMENTATION EXTENSION VENDOR SCRIPTS"><b>IMPLEMENTATION EXTENSION VENDOR SCRIPTS</b></a></h3><pre>   <b>checksig &lt;</b><i>path</i><b>&gt;/catalog/&lt;</b><i>dfiles</i><b>&gt;/checksig</b>
       A vendor may choose to provide a <b>checksig</b> script.  The <b>checksig</b>  script
       is part of the distribution object.  It is used to verify the directory
       form of a distribution   (as  distinguished  from  installed_software).
       The verified attributes are the same as those verified from the archive
       file form with the addition of the distribution file list.  In addition
       the  script may chose to verify the <i>adjunct</i><b>_</b><i>md5sum</i> and file.md5 digests
       and symbolic links.  Due to the constraints of reproducing the  archive
       message  digests  from  the directory, which include tar utility depen-
       dence and file owner/group specification, this script may not be useful
       to all vendors.

   <a name="Execution Environment"><b>Execution Environment</b></a>
        The  script  should require the SW_CONTROL_TAG environment variable be
       set to &quot;checksig&quot; and if not exit with failure.
</pre><h3><a name="VERIFYING SIGNATURES"><b>VERIFYING SIGNATURES</b></a></h3><pre>       The design separates the payload and catalog,  therefore,  verification
       requires verifying the storage section md5 and sha1 message digests and
       then verifying the signature of the catalog.  Naturally, it is required
       that  the  signed  data include the storage section message digests and
       that they match the storage sections.  The storage section digests  are
       stored as separate attribute files in the dfiles catalog directory.

       The  <b>checksig</b>  mode checks all the security files in the package and is
       the preferred way to authenticate  a  package.   The  <b>emit-signed-file</b>,
       <b>emit-digest-file</b> modes are useful for testing, sanity checks and custom
       applications.  The <b>get-sig-if</b> is the function used by <b>checksig</b>.

   <a name="Verifying a POSIX distribution Manually"><b>Verifying a POSIX distribution Manually</b></a>
       The design of the authentication attributes supports  manual  verifica-
       tion of the directory (unpacked) form of the distribution, that is ver-
       ification takes place on the leading package  directory  and  its  con-
       tents.  It  should  be noted that it is left to the user to verify that
       the archive installed no files outside of this directory as this  would
       likely indicate a trojan'ed package.

       If authenticating on a GNU/Linux system using GNU tar it is possible to
       validate the archive message digests and signature if the following are
       true:


       1) The package file is a tar archive.
       2) The installed version of GNU tar produces archives with
          bit-for-bit sameness relative to the <a href=swpackage_8.html>swpackage(8)</a> utility
          that generated the signature and message digests.
       3) The package has a single leading package directory.
       4) The package catalog contains the 'checksig' script.
       5) The package catalog contains the distribution file list.
       6) The ownership names are present and have the same uid's and gid's.
       7) The package was unpacked with a version of tar that
          preserves all file times.


       In  this  example,  the  package  has  a  constant leading path called,
       <b>namedir</b> and the file owner/group  are  root.   These  restrictions  are
       suited to source packages.
        Verify the signature:

         #!/bin/sh
         tar cf - -b1 --owner=root --group=root \
         --exclude=namedir/catalog/dfiles/signature  \
         namedir/catalog | gpg --verify namedir/catalog/dfiles/signature -

       If  this  fails  try using GNU tar option --posix.  If this fails then,
       try experimenting with the owner, group, and  numeric-id  options.   If
       you  are  unable to verify a tar byte stream using <a href=gpg_1.html>gpg(1)</a> that contains
       the storage section message digests, then the package cannot be authen-
       ticated.


       Assuming you successfully verified the catalog as shown above, now gen-
       erate the message digest and compare it to the  md5sum  file  attribute
       from the same byte stream that <a href=gpg_1.html>gpg(1)</a> claims is authenticate.

         #!/bin/sh
         grep -v namedir/catalog  namedir/catalog/dfiles/files | \
         tar cf - -b1 --owner=root --group=root \
         --files-from=- --no-recursion | md5sum

         tar cf - -b1 --owner=root --group=root \
         --exclude=namedir/catalog/dfiles/signature  \
         namedir/catalog | tar xf - -O  namedir/catalog/dfiles/md5sum

       Likewise for the sha1 digest.

       If the package has symbolic links, Verify the adjunct_md5sum:

         #!/bin/sh
         grep -v namedir/catalog  namedir/catalog/dfiles/files | \
         ( while read file; do if [ ! -h $file ]; then echo $file; fi done; )|\
         tar cf - -b1 --owner=root --group=root \
         --files-from=- --no-recursion | md5sum
         cat namedir/catalog/dfiles/adjunct_md5sum

       The  symbolic  link files must be verified manually by comparing to the
       INFO file information.

   <a name="Verifying a POSIX distribution in tar format"><b>Verifying a POSIX distribution in tar format</b></a>
       Below is output from  successful  authentication.   The  authentication
       requires checking the archive md5 message digest (and sha1 if present).
       All present message digests must succeed and if this is true  then  the
       signed file is written and gpg proceeds to check the signature.  If the
       <b>sig_header</b> file is present then the requirement that its data be  iden-
       tical  to the ustar header of every signature file is enforced.  If any
       one of these checks fails, authentication fails.

          #!/bin/sh
          swverify --checksig mypackage-00.1.tar.gz
               # - or -
          swverify -d @- &lt; mypackage-00.1.tar.gz


       gpg: /home/userx/.gnupg/options:82: deprecated option &quot;honor-http-proxy&quot;
       gpg: please use &quot;keyserver-options honor-http-proxy&quot; instead
       gpg: WARNING: using insecure memory!
       gpg: please see <a href="http://www.gnupg.org/faq.html">http://www.gnupg.org/faq.html</a> for more information
       swbis: Archive digest: md5 OK (Good)
       swbis: Archive digest: sha1 OK (Good)
       gpg: Signature made Sun Mar 16 20:28:23 2003 EST using DSA key ID 82B0DBE4
       gpg: Good signature from &quot;Test User (pass=Iforgot) localhost&gt;&quot;
       Primary key fingerprint: 77BB A98E B3A2 ED4C 217E  8A25 2BF4 28AB 82D0 DDE4


   <a name="Verifying the directory (unpacked) form of a Distribution."><b>Verifying the directory (unpacked) form of a Distribution.</b></a>
       Authenticating using 'swverify' is subject to the same  constraints  as
       verifying  manually  using  GNU  tools because swverify implements this
       using GNU tools.

       'swverify', when  verifying  the  directory  form  of  a  distribution,
       attempts  to  authenticate  the exported catalog signature and if it is
       successful executes the 'checksig' script found in the 'dfiles' distri-
       bution  directory  of  the  exported catalog.  If the 'checksig' script
       does not exist, authentication fails. 'swverify' will only  attempt  to
       run  'checksig'  if it is found in the dfiles directory of an authenti-
       cated catalog.

       'swverify' currently has no provision to  verify  the  archive  section
       (i.e.  the  file storage structure) of a directory form POSIX distribu-
       tion besides execution of the vendor extension script 'checksig'.

       If filemypackage-00.1 is a directory unpacked with a tar reading  util-
       ity that preserved file times then try,


          #!/bin/sh
          swverify --checksig mypackage-00.1

        or change directory into mypackage-00.1 and use the posix syntax:

          swverify -d @.



          swverify -d @`pwd`/mypackage-00.1

        Below is example output of a package with a 'checksig' script.


       swverify: Attempting to verify using --posix tar option.
       gpg: /home/userx/.gnupg/options:82: deprecated option &quot;honor-http-proxy&quot;
       gpg: please use &quot;keyserver-options honor-http-proxy&quot; instead
       gpg: WARNING: using insecure memory!
       gpg: please see <a href="http://www.gnupg.org/faq.html">http://www.gnupg.org/faq.html</a> for more information
       gpg: Signature made Sun Mar 16 21:00:54 2003 EST using DSA key ID 82B0DBE4
       gpg: BAD signature from &quot;Test User (pass=Iforgot) localhost&gt;&quot;
       swverify: First attempt failed.
       swverify: Attempting to verify without using --posix tar option.
       gpg: /home/jhl/.gnupg/options:82: deprecated option &quot;honor-http-proxy&quot;
       gpg: please use &quot;keyserver-options honor-http-proxy&quot; instead
       gpg: WARNING: using insecure memory!
       gpg: please see <a href="http://www.gnupg.org/faq.html">http://www.gnupg.org/faq.html</a> for more information
       gpg: Signature made Sun Mar 16 21:00:54 2003 EST using DSA key ID 82B0DBE4
       gpg: Good signature from &quot;Test User (pass=Iforgot) localhost&gt;&quot;
       gpg: WARNING: This key is not certified with a trusted signature!
       gpg:          There is no indication that the signature belongs to the owner.
       Primary key fingerprint: 77BB A98E B3A2 ED4C 217E  8A25 2BF4 28AB 82D0 DDE4
       swverify: GPG signature verified.
       swverify: Got it!
       swverify: The vendor extension script checksig can now be executed.
       checksig: Checking files OK (Good)
       checksig: Checking Archive md5 OK (Good)
       checksig: Checking Archive sha1 OK (Good)
       gpg: /home/userx/.gnupg/options:82: deprecated option &quot;honor-http-proxy&quot;
       gpg: please use &quot;keyserver-options honor-http-proxy&quot; instead
       gpg: WARNING: using insecure memory!
       gpg: please see <a href="http://www.gnupg.org/faq.html">http://www.gnupg.org/faq.html</a> for more information
       gpg: Signature made Sun Mar 16 21:00:54 2003 EST using DSA key ID 82B0DBE4
       gpg: Good signature from &quot;Test User (pass=Iforgot) localhost&gt;&quot;
       gpg: WARNING: This key is not certified with a trusted signature!
       gpg:          There is no indication that the signature belongs to the owner.
       Primary key fingerprint: 77BB A98E B3A2 ED4C 217E  8A25 2BF4 28AB 82D0 DDE4
       checksig: Signature proper OK (Good)
       checksig: /usr/bin/gpg exit status : 0



   <a name="Verifying Installed Software"><b>Verifying Installed Software</b></a>
       (This  capability  is only partially implemented.)  Verifying Installed
       Software involves comparing the package meta-data to the live file sys-
       tem.   The  validity of a successful comparison depends on the validity
       of the installed software catalog.  swverify makes no attempt to  check
       the  validity  of the entire catalog, however, it can use the distribu-
       tion GPG signature, which is stored in the catalog, to authenticate the
       meta-data of the selected package.

       Below  is an example. Note, the package is selected on the basis of its
       product or bundle tag.

       $ swverify -r your_product_tag @ /
       swverify: verifying installed software at:
       swverify: //var/lib/swbis/catalog/swbis/your_product_tag/0.000/0
       gpg: WARNING: --honor-http-proxy is a deprecated option.
       gpg: please use &quot;--keyserver-options honor-http-proxy&quot; instead
       gpg: Signature made Fri Feb 20 00:21:00 2004 EST using DSA key ID 82B0DBE4
       gpg: Good signature from &quot;Test User (pass=Iforgot) localhost&gt;&quot;
       gpg: WARNING: This key is not certified with a trusted signature!
       gpg:          There is no indication that the signature belongs to the owner.
       Fingerprint: 77BB B98D A3A2 ED4C 217E  9A25 8BF4 05AB 82B0 DBE4
       swverify: Warning: file checks not implemented
       swverify: signature verification return status=0



   <b>Create the digest byte stream -Wemit-digest-file mode:</b>
       Here are some examples that verify the archive digests.


          #!/bin/sh
          cat your-tarball | swverify -Wd -WS | md5sum


       Your should see a pair of identical digests. Use the -Wsha1  option  to
       check the sha1 digest in a similar manner.

       ** IMPORTANT **
       This  does not mean that the data is authenticate in the sense of being
       attributable to a person, merely that the md5sum attribute and the pay-
       load byte stream match.

       To inspect the digested data, try:

         #!/bin/sh
         cat your-tarball | swverify -WS | tar tvf -


   <b>Create the signed byte stream -Wemit-signed-file mode:</b>
       Here is an example which allows inspection of the signed file.


         cat your-tarball | swverify -WC | tar tvf -


   <b>-Wget-sig-if mode:</b>
       This is the mode used by <b>--checksig</b>.  Here is an example.


         #!/bin/sh
         cat your-tarball | swverify -Wget-sig-if=/dev/tty | \
         gpg --verify  /dev/tty -


       Now  try to copy and paste the sigfile and gpg should attempt to verify
       the signature.

              <b>Note:</b>  <b>This verifies the md5 or sha1 digests before writing</b>  <b>the</b>
              <b>signed</b>  <b>data</b>  <b>to stdout.</b>  <b>If the sha1 or md5 match fails then an</b>
              <b>empty file is written to stdout.</b>
</pre><h3><a name="EXAMPLES"><b>EXAMPLES</b></a></h3><pre>       Examples of verifying distributions and installed software.

   <a name="Distribution Verification"><b>Distribution Verification</b></a>
       * Verify a tar archive

         swverify -d &lt; foo-1.1.tar.gz
                  or
         swverify -d @`pwd`/foo-1.1.tar.gz

                 Note: --checksig and '-d' perform the same operations.


       * Verify a unpacked distribution

         swverify -d @`pwd`/foo-1.1
                  or
         swverify -d @.

                 Note: --checksig and '-d' perform the same operations.


   <a name="Installed Software Verification"><b>Installed Software Verification</b></a>
       * Verify installed software

         swverify -r foo.foo @/tmp/test
                  or
         swverify -r foo.foo

                 Note: This will attempt to verify the GPG signature.
                       The posix operations are not yet implemented.

</pre><h3><a name="RETURN VALUE"><b>RETURN VALUE</b></a></h3><pre>       Exit status of the checksig script or gpg utility for --checksig direc-
       tory  operation.   0  if  successful on all targets, 1 if failed on all
       targets, 2 if failed on some targets.
</pre><h3><a name="FILES"><b>FILES</b></a></h3><pre>       None

</pre><h3><a name="APPLICABLE STANDARDS"><b>APPLICABLE STANDARDS</b></a></h3><pre>       IEEE Std 1387.2-1995 (ISO/IEC 15068-2:1999), Open Group CAE C701.
</pre><h3><a name="SEE ALSO"><b>SEE ALSO</b></a></h3><pre>       <a href=sw_5.html>sw(5)</a>, <a href=swign_1.html>swign(1)</a>, <a href=swpackage_8.html>swpackage(8)</a>, <a href=gpg_1.html>gpg(1)</a>, libexec/swbis/arf2arf

</pre><h3><a name="IDENTIFICATION"><b>IDENTIFICATION</b></a></h3><pre>        <a href=swverify_8.html>swverify(8)</a>: The verification utility of the swbis project.
        Author: J. Lowe <a href="mailto:jhlowe@acm.org">jhlowe@acm.org</a>
        Version: 0.406
        Date: 2004-09-01
        Copying: GNU Free Documentation License
</pre><h3><a name="BUGS"><b>BUGS</b></a></h3><pre>       The signature file's archive header (or data) is not part of the signed
       data  therefore  it  may be subject to undetectable tampering, however,
       swverify does perform sanity checks on the  pathname,  permissions  and
       filetype if the <b>sig_header</b> file (See <a href=sw_5.html>sw(5)</a> manual page.) is not present
       [due to being signed by a old swpackage version], and if <b>sig_header</b>  is
       present,  swverify  requires  that  it  match the sig file header.  The
       ability to verify the unpacked directory form of the package depends on
       many  factors  not  immediately  obvious, among them are the tar header
       uname and gname, and whether they are preserved by the reading utility,
       and  whether  these  names are in the system database files /etc/passwd
       and /etc/group, and if so, whether they assign the same uid/gid as  the
       package, and whether the file system orders directory entries according
       to order of entry creation.



                                                                   <a href=swverify_8.html>swverify(8)</a>
</pre><hr><a href="../index.html">[ Index ]</a> <a href="javascript:history.back()"> [ Back ]</a></body></html>
